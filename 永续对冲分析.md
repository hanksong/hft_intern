任何币的收益是：

$$
PnL = (amount_t - amount_0) \times price_t
$$

对冲目标不是价值不变，是（潜在的）币数量不变
两种情况有别：

![image](https://huobiglobal.zendesk.com/hc/article_attachments/900005644783/APP___-_.PNG)

永续合约PnL的计算：https://huobiglobal.zendesk.com/hc/en-us/articles/900000728106-What-is-calculation-rule-for-closing-profit-after-settlement-

---

## 币本位合约对冲

1. 使用和池子比例相同的合约数量
2. long头寸

### case1

1. 假设GLP池含有（30000\$U + 30000\$BTC) , 此时BTC价格为\$30000, GLP价格为1\$
2. BTC价格变为\$31000 , GLP池子即(30000\$U + 31000\$BTC) , GLP 价格变为$61000/60000 = 1.017\

$$


$$

1. 显然，我一开始如果存入1BTC，换得30000GLP，最终只能换出

$$
\frac{30000 * 1.0167}{31000} = 0.9838(BTC)
$$

购买GLP和出售GLP后，BTC数量减少了。

1. 如果我使用了币本位合约，我一开始用0.5个BTC的long合约对冲，此时我的合约PnL是

$$
(1/30000 - 1/ 31000) \times 0.5 \times 30000 = 0.0161(BTC)
$$

正好弥补上一步中BTC的亏损，而保证金占用(全额)则为0.5个BTC

### case2

1. 仍保持前GLP池，假设BTC价格跌到\$29000，此时GLP池子是（\$30000 + \$29000）GLP价格为\$59000/60000 = 0.9833\$
2. 我一开始存入了1BTC，得到30000GLP，最终换出的BTC为

$$
\frac{30000\times 0.9833}{29000} = 1.0172(BTC)
$$

1. 如果我使用了币本位合约，我一开始持有0.5个BTC的long头寸，此时我的合约PnL为

$$
（1/30000 - 1/29000）\times 0.5 \times 30000 = -0.0172(BTC)
$$

---

## U本位合约

1. 使用和池子比例相同的合约数量
2. short头寸

### case1

1. 同样假设5050的比例，BTC价格有\$30000涨到\$31000，此时GLP池子是（\$30000 + \$31000）GLP价格为\$61000/60000 = 1.0167\$
2. 我一开始存入30000usdt，得到30000GLP，最终换出的usdt为

$$
30000\times 1.0167= 30500(usdt)
$$

3. 如果我使用了U本位合约，我一开始持有$15000(相当于0.5个btc)的short头寸，此时我的合约PnL为

$$
(30000-31000) * 0.5 = -500(usdt)
$$

### case2

1. 同样假设5050的比例，BTC价格有\$30000跌到\$29000，此时GLP池子是（\$30000 + \$29000）GLP价格为\$59000/60000 = 0.9833\$
2. 我一开始存入30000usdt，得到30000GLP，最终换出的usdt为

$$
30000\times 0.9833 = 29500(usdt)
$$

3. 如果我使用了U本位合约，我一开始持有$15000(相当于0.5个btc)的short头寸，此时我的合约PnL为

$$
(30000 - 29000) * 0.5 = 500(usdt)
$$

---

结论

* 用币买glp，此时需要保证币数量不变，需要使用币本位合约。
* 用u买glp，此时需要用u本位合约。
* 现货的case并不能保证币数量不变，只能保证价值不变。
  * 举例，借来0.5btc价值3w卖出，价格上涨到31000时，PnL = - 500，而gmx方面的btc只剩下0.9838。但是因为0.9838 * 31000 = 30500，所以总价值没变，但是btc少了。
  * 从另一个思路看：要归还0.5个btc需要15500去买btc，最终剩下15000 + 30500 - 15500 = 30000元。即btc减少，总价值没变。

---

# 永续合约一般规律

[永续合约资金费率策略 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/373654721)

* **永续合约每8小时结算一次**：每次结算会有资金费率，由多空双方的其中一方向另一方支付。
* 资金费率有**时延性**：在期初（08:00）确定，在期末（16:00）结算。
* **有偏分布**：资金费率常年为正（多头支付）

---

# 现货对冲

### case1

1. 仍然假设GMX池子是（30000\$U + 30000\$BTC) , 此时BTC价格为\$30000, GLP价格为1\$。
2. 我希望用现货对冲，此时我持有GLP是看多，我需要借入0.5个BTC，卖出，此时我的总资产是 30000\$U + 0.5\$BTC * 30000 = 45000\$U
3. BTC价格变为\$31000 , GLP池子即(30000\$U + 31000\$BTC) , GLP 价格变为$61000/60000 = 1.017\，此时我的总资产是1.017\$ * 30000 + 15000 = 45500\$U
4. 我用GLP换成BTC，总值为1.017 * 30000 / 31000  = 0.9838个BTC，然后我现在手上有0.9838个BTC和15000\$U，价值分别为30500和15000，总值为45500\$U
   5。 为了偿还借入的0.5个BTC，我需要花费0.5 * 31000 = 15500\$U。U少500，只能卖出500 / 31000 = 0.0161个BTC，最终手上有0.9838 - 0.0161 = 0.9677个BTC，总值为31000 * 0.9677 = 30000\$U。

从case1可以看到，现货对冲时，我投入的时BTC，价格上升后最终我的BTC少了，但是总值不变。用U本位合约能达到相同的效果，如果U本位合约只做(1x)short，那只需考虑资金费率和借贷成本了。

### case2

#
